# FEUILLET DE PROMPTS - D√©fi #15 : Hedwige

**D√©fi :** Web app d'envoi/r√©ception de mails avec OAuth2.0  
**Points :** 80 pts  
**Objectif :** Application compl√®te avec front, middleware, tests unitaires  
**Temps estim√© :** 5 heures  
**Int√©gration :** Patronus Loader (#9) pour BONUS

---

## üéØ PROMPT 1 : Architecture de l'Application

**Prompt utilis√© :**
```
Con√ßois l'architecture compl√®te d'une web application appel√©e "Hedwige" qui permet :

1. **Fonctionnalit√©s principales :**
   - Envoi et r√©ception d'emails avec compte √©tudiant
   - Connexion √† d'autres services via OAuth2.0 (Google, Microsoft, GitHub)
   - Interface utilisateur moderne et intuitive
   - Gestion des contacts
   - Recherche dans les emails

2. **Stack technique :**
   - Frontend : React + TypeScript + Tailwind CSS
   - Backend : Node.js + Express + TypeScript
   - Base de donn√©es : PostgreSQL
   - Auth : OAuth2.0 (Passport.js)
   - Email : IMAP/SMTP (Nodemailer)
   - Tests : Jest + React Testing Library (>80% coverage)

3. **Architecture :**
   D√©finis :
   - Structure des dossiers (monorepo)
   - API endpoints
   - Mod√®les de donn√©es
   - Flux d'authentification
   - Diagramme d'architecture

Format : Documentation technique d√©taill√©e avec diagrammes ASCII.
```

**R√©sultat obtenu :**

```
ARCHITECTURE HEDWIGE
====================

üìÅ Structure du Projet (Monorepo)
----------------------------------
hedwige/
‚îú‚îÄ‚îÄ frontend/                 # Application React
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/      # Composants r√©utilisables
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PatronusLoader/  # D√©fi #9 int√©gr√© !
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EmailList/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EmailComposer/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Header/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/           # Pages de l'app
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Inbox/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Compose/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Settings/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/        # API calls
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/           # Custom hooks
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/           # TypeScript types
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ tests/               # Tests unitaires
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ
‚îú‚îÄ‚îÄ backend/                  # API Node.js
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/     # Logique m√©tier
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ email.controller.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ oauth.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/        # Services m√©tier
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ email.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ imap.service.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ smtp.service.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/          # Routes API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/      # Middlewares
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/          # Mod√®les DB
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/          # Configuration
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ tests/               # Tests unitaires
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ
‚îú‚îÄ‚îÄ shared/                   # Code partag√©
‚îÇ   ‚îî‚îÄ‚îÄ types/               # Types partag√©s
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml       # Dev environment
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ package.json             # Root package

üîó API Endpoints
----------------
Auth:
  POST   /api/auth/login              - Login avec email
  POST   /api/auth/oauth/google       - OAuth Google
  POST   /api/auth/oauth/microsoft    - OAuth Microsoft
  POST   /api/auth/oauth/github       - OAuth GitHub
  POST   /api/auth/refresh            - Refresh token
  POST   /api/auth/logout             - Logout

Emails:
  GET    /api/emails                  - Liste des emails
  GET    /api/emails/:id              - D√©tail email
  POST   /api/emails                  - Envoyer email
  DELETE /api/emails/:id              - Supprimer email
  PUT    /api/emails/:id/read         - Marquer lu
  GET    /api/emails/search?q=        - Rechercher

Contacts:
  GET    /api/contacts                - Liste contacts
  POST   /api/contacts                - Ajouter contact
  DELETE /api/contacts/:id            - Supprimer contact

Services:
  GET    /api/services/connected      - Services connect√©s
  POST   /api/services/connect        - Connecter service
  DELETE /api/services/:id            - D√©connecter

üìä Mod√®les de Donn√©es
---------------------
User:
  - id: UUID
  - email: string
  - name: string
  - password: hash (optionnel si OAuth)
  - refresh_token: string
  - created_at: timestamp
  - updated_at: timestamp

Email:
  - id: UUID
  - user_id: UUID (FK)
  - from: string
  - to: string[]
  - cc: string[]
  - subject: string
  - body: text
  - html: text
  - attachments: json
  - is_read: boolean
  - is_draft: boolean
  - folder: string (inbox/sent/trash)
  - created_at: timestamp

Contact:
  - id: UUID
  - user_id: UUID (FK)
  - name: string
  - email: string
  - avatar: string
  - created_at: timestamp

OAuthService:
  - id: UUID
  - user_id: UUID (FK)
  - provider: string (google/microsoft/github)
  - access_token: string (encrypted)
  - refresh_token: string (encrypted)
  - expires_at: timestamp
  - created_at: timestamp

üîê Flux d'Authentification OAuth2.0
------------------------------------
1. User clique "Se connecter avec Google/Microsoft/GitHub"
2. Redirection vers provider OAuth
3. User autorise l'application
4. Provider redirige avec code d'autorisation
5. Backend √©change code contre access_token
6. Backend cr√©e/r√©cup√®re User en DB
7. Backend g√©n√®re JWT pour l'app
8. Frontend stocke JWT (httpOnly cookie)
9. Requ√™tes suivantes incluent JWT

üèóÔ∏è Diagramme d'Architecture
----------------------------
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Browser   ‚îÇ
‚îÇ   (React)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ HTTPS
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Load Balancer     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   API Gateway       ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  OAuth2.0    ‚îÇ
‚îÇ   (Express)         ‚îÇ      ‚îÇ  Providers   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚ñº          ‚ñº          ‚ñº          ‚ñº
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ  Auth   ‚îÇ ‚îÇ  Email  ‚îÇ ‚îÇ IMAP ‚îÇ ‚îÇ SMTP ‚îÇ
  ‚îÇ Service ‚îÇ ‚îÇ Service ‚îÇ ‚îÇClient‚îÇ ‚îÇClient‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ           ‚îÇ          ‚îÇ        ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ  PostgreSQL  ‚îÇ
            ‚îÇ   Database   ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

üìà Tests Unitaires (>80% Coverage)
-----------------------------------
Frontend Tests:
  - Components (React Testing Library)
  - Hooks (custom hooks)
  - Services (API calls mocked)
  - Utils (helpers)

Backend Tests:
  - Controllers (business logic)
  - Services (email, auth)
  - Routes (API endpoints)
  - Middleware (auth, validation)

Coverage Targets:
  - Statements: >80%
  - Branches: >75%
  - Functions: >80%
  - Lines: >80%
```

---

## üéØ PROMPT 2 : Configuration du Projet et D√©pendances

**Prompt utilis√© :**
```
G√©n√®re tous les fichiers de configuration pour le projet Hedwige :

1. **Package.json** (root, frontend, backend)
2. **TypeScript config** (tsconfig.json)
3. **ESLint et Prettier** config
4. **Jest config** pour les tests
5. **Docker compose** pour dev
6. **Environment variables** (.env.example)
7. **README** avec instructions setup

Technologies :
- React 18 + TypeScript + Vite
- Node.js 20 + Express + TypeScript
- PostgreSQL 15
- Tailwind CSS
- Jest + Testing Library
- Passport.js (OAuth2.0)

G√©n√®re le code complet et comment√©.
```

**R√©sultat :** Fichiers de config dans `backend/` et `frontend/`

---

## üéØ PROMPT 3 : Backend - API et Services Email

**Prompt utilis√© :**
```
Impl√©mente le backend complet de Hedwige :

1. **Service Email (IMAP/SMTP)**
   - Connexion IMAP pour recevoir emails
   - Connexion SMTP pour envoyer emails
   - Parsing des emails
   - Gestion des pi√®ces jointes

2. **Authentication Service**
   - JWT tokens
   - OAuth2.0 (Google, Microsoft, GitHub)
   - Passport.js strategies
   - Refresh tokens

3. **Controllers**
   - Email controller (CRUD)
   - Auth controller
   - OAuth controller

4. **Routes avec validation**
   - Input validation (Joi/Zod)
   - Error handling
   - Rate limiting

5. **Middleware**
   - Auth middleware (JWT)
   - Error handler
   - Logger

Code TypeScript complet avec:
- Typage strict
- Error handling
- Logging
- Tests unitaires Jest (>80%)
```

**R√©sultat :** Code backend complet dans `backend/src/`

---

## üéØ PROMPT 4 : Frontend - Interface Utilisateur

**Prompt utilis√© :**
```
Cr√©e le frontend complet de Hedwige avec React + TypeScript :

1. **Pages principales :**
   - Login (avec OAuth buttons)
   - Inbox (liste emails)
   - Email Detail (lecture)
   - Compose (r√©daction)
   - Settings (param√®tres)

2. **Composants r√©utilisables :**
   - EmailList (liste virtualis√©e)
   - EmailCard (aper√ßu email)
   - EmailComposer (√©diteur riche)
   - Header (navigation)
   - Sidebar (folders)
   - **PatronusLoader (int√©gration d√©fi #9) !**

3. **Features :**
   - Recherche temps r√©el
   - Pagination/infinite scroll
   - Drag & drop pour pi√®ces jointes
   - Dark mode
   - Responsive design (mobile-first)

4. **State Management :**
   - React Query pour data fetching
   - Zustand pour state global
   - React Hook Form pour formulaires

5. **Design System :**
   - Tailwind CSS
   - Headless UI pour modals/dropdowns
   - Lucide React pour ic√¥nes
   - Framer Motion pour animations

G√©n√®re le code avec :
- TypeScript strict
- Accessibilit√© (ARIA)
- Performance optimis√©e
- Tests (React Testing Library)
```

**R√©sultat :** Code frontend complet dans `frontend/src/`

---

## üéØ PROMPT 5 : Tests Unitaires Complets

**Prompt utilis√© :**
```
G√©n√®re une suite de tests compl√®te pour Hedwige (>80% coverage) :

**Backend Tests (Jest):**

1. **Services Tests :**
   - email.service.test.ts (IMAP/SMTP mocking)
   - auth.service.test.ts (JWT, OAuth flow)
   
2. **Controllers Tests :**
   - email.controller.test.ts
   - auth.controller.test.ts

3. **Routes Tests (supertest) :**
   - API endpoints testing
   - Error cases
   - Validation

**Frontend Tests (RTL):**

1. **Components Tests :**
   - EmailList.test.tsx
   - EmailComposer.test.tsx
   - PatronusLoader.test.tsx

2. **Hooks Tests :**
   - useAuth.test.ts
   - useEmails.test.ts

3. **Integration Tests :**
   - Login flow
   - Send email flow
   - OAuth flow

Avec :
- Mocking (API, DB)
- Coverage reports
- CI/CD ready
```

**R√©sultat :** Tests dans `backend/tests/` et `frontend/tests/`

---

## üéØ PROMPT 6 : Documentation Technique

**Prompt utilis√© :**
```
R√©dige la documentation technique compl√®te de Hedwige :

1. **README.md principal**
   - Description du projet
   - Features
   - Screenshots (descriptions textuelles)
   - Installation
   - Usage
   - Architecture

2. **API Documentation (OpenAPI/Swagger)**
   - Tous les endpoints
   - Sch√©mas de donn√©es
   - Exemples de requ√™tes

3. **Guide de D√©ploiement**
   - Docker deployment
   - Environment variables
   - Database setup
   - OAuth setup (Google, Microsoft, GitHub)

4. **Guide de Contribution**
   - Code style
   - Git workflow
   - Tests

5. **ARCHITECTURE.md**
   - D√©cisions techniques
   - Patterns utilis√©s
   - S√©curit√©

Format Markdown professionnel avec diagrammes.
```

**R√©sultat :** Documentation compl√®te

---

## üìä VALIDATION DU D√âFI

### Crit√®res de Validation

- ‚úÖ **Frontend React + TypeScript** : Complet
- ‚úÖ **Backend Node.js + Express** : Complet  
- ‚úÖ **OAuth2.0 (Google/Microsoft/GitHub)** : Impl√©ment√©
- ‚úÖ **Envoi/R√©ception emails** : IMAP/SMTP fonctionnel
- ‚úÖ **Tests unitaires >80%** : Coverage atteint
- ‚úÖ **Documentation compl√®te** : README, API docs, Architecture
- ‚úÖ **PatronusLoader int√©gr√©** : BONUS d√©fi #9 !
- ‚úÖ **Responsive & Accessible** : Mobile-first, ARIA
- ‚úÖ **Code de qualit√©** : TypeScript strict, ESLint, Prettier

### Stack Technique Finale

**Frontend :**
- React 18 + TypeScript + Vite
- Tailwind CSS + Headless UI
- React Query + Zustand
- React Hook Form
- PatronusLoader (D√©fi #9) ‚ú®

**Backend :**
- Node.js 20 + Express + TypeScript
- PostgreSQL 15 + Prisma ORM
- Passport.js (OAuth2.0)
- Nodemailer (SMTP) + node-imap (IMAP)
- Jest (tests)

**DevOps :**
- Docker + Docker Compose
- GitHub Actions (CI/CD - D√©fi #5)
- Terraform (PRA - D√©fi #2)

### Bonus Obtenus

- üé® **Int√©gration Patronus** : +5 pts (d√©fi #9)
- üß™ **Tests >80% coverage** : Requis
- üìö **Documentation excellente** : Requis
- üé® **UI/UX exceptionnelle** : Bonus possible

**Statut :** ‚úÖ VALID√â  
**Points :** 80 pts (+ 5 pts bonus Patronus) = **85 pts**  
**Temps r√©el :** 5 heures  
**Total cumul√© :** 145 pts

